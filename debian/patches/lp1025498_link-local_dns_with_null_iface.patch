From: Mathieu Trudel-Lapierre <mathieu.trudel-lapierre@canonical.com>
Subject: Don't crash if we have no iface to append to the link-local
 nameserver address.
Bug-Ubuntu: http://bugs.launchpad.net/bugs/1025498

---
 src/dns-manager/nm-dns-dnsmasq.c |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

Index: b/src/dns-manager/nm-dns-dnsmasq.c
===================================================================
--- a/src/dns-manager/nm-dns-dnsmasq.c
+++ b/src/dns-manager/nm-dns-dnsmasq.c
@@ -168,8 +168,10 @@ ip6_addr_to_string (const struct in6_add
 		 * only since version 2.58 and up
 		 */
 		*p = '@';
-	} else if (IN6_IS_ADDR_LINKLOCAL (addr)) {
-		/* If we got no scope identifier at all append the interface name */
+	} else if (IN6_IS_ADDR_LINKLOCAL (addr) && iface != NULL) {
+		/* If we got no scope identifier at all append the interface name,
+		 * if we have it.
+		 */
 		strncat (buf, "@", IP6_ADDR_BUFLEN - strlen (buf));
 		strncat (buf, iface, IP6_ADDR_BUFLEN - strlen (buf));
 	}
